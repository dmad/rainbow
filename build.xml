<?xml version="1.0"?>

<project name="rainbow"
	 default="all"
	 basedir=".">

  <property name="version.number" value="0.0.17"/>

  <property name="deps.dir" value="deps"/>

  <property name="src.dir" value="src"/>

  <property name="build.dir" value="build"/>
  <property name="build.classes.dir" value="${build.dir}/classes"/>
  <property name="build.lib.dir" value="${build.dir}/lib"/>

  <path id="classpath">
    <pathelement location="${deps.dir}/niosax-10.7.2.jar"/>
  </path>

  <target name="prepare">
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.classes.dir}"/>
    <mkdir dir="${build.classes.dir}/main/java"/>
    <mkdir dir="${build.classes.dir}/test/java"/>
    <mkdir dir="${build.lib.dir}"/>
  </target>

  <target name="clean"
	  description="deletes all build files (classes and libs)">
    <delete dir="${build.classes.dir}"/>
    <delete dir="${build.lib.dir}"/>
  </target>

  <target name="bump-build-number"
	  description="increments the build number">
    <buildnumber/>
  </target>

  <target name="compile-main"
	  depends="prepare,bump-build-number"
	  description="compiles all code">
    <javac srcdir="${src.dir}/main/java"
	   destdir="${build.classes.dir}/main/java"
	   deprecation="true"
	   debug="true"
	   debuglevel="source,lines"
	   source="1.8"
	   target="1.8"
	   includeantruntime="false">
      <compilerarg value="-Xlint"/>
      <include name="**"/>
      <classpath>
	<path refid="classpath"/>
      </classpath>
     </javac>
  </target>

  <target name="compile-test"
	  depends="prepare,bump-build-number,compile-main"
	  description="compiles all test code">
    <javac srcdir="${src.dir}/test/java"
	   destdir="${build.classes.dir}/test/java"
	   deprecation="true"
	   debug="true"
	   debuglevel="source,lines"
	   source="1.8"
	   target="1.8"
	   includeantruntime="false">
      <compilerarg value="-Xlint"/>
      <include name="**"/>
      <classpath>
	<pathelement location="${build.classes.dir}/main/java"/>
      </classpath>
    </javac>
  </target>

  <target name="package"
	  depends="compile-main"
	  description="packages all classes into a jar file">
    <jar destfile="${build.lib.dir}/rainbow.jar"
	 basedir="${build.classes.dir}/main/java">
      <manifest>
	<attribute name="Built-By" value="${user.name}"/>
	<attribute name="Implementation-Version"
		   value="${version.number}-b${build.number}"/>
      </manifest>
    </jar>
  </target>

  <target name="all"
	  depends="clean,package,compile-test"
	  description="cleans, then builds everything"/>

</project>
